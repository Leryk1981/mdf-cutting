# Программа для раскроя МДФ накладок

## Описание проекта

Данное приложение предназначено для автоматизации процесса раскроя МДФ накладок и других материалов. Программа позволяет оптимально размещать детали на листах материала, создавать DXF-файлы для фрезерных станков и эффективно управлять остатками материала.

### Основные возможности

- Оптимальное размещение деталей на листах материала с учетом их размеров и особенностей
- Приоритетное использование остатков материала перед целыми листами
- Автоматическое создание DXF-файлов для фрезерных станков
- Учет фасок, отступов и размеров фрезы
- Работа с различными типами и толщинами материалов
- Отслеживание и управление остатками материала
- Удобный графический интерфейс для настройки и запуска процесса

## Требования к системе

- Windows 7/8/10/11
- Python 3.7 или выше (если запускаете из исходного кода)
- Библиотеки: pandas, ezdxf, rectpack (установка через requirements.txt)

## Установка

### Вариант 1: Запуск готового исполняемого файла

1. Скачайте последнюю версию программы из [репозитория]
2. Распакуйте архив в удобное место
3. Запустите файл `main.exe`

### Вариант 2: Запуск из исходного кода

1. Клонируйте репозиторий:

```
git clone [URL репозитория]
```

2. Перейдите в директорию проекта:

```
cd [имя папки проекта]
```

3. Установите зависимости:

```
pip install -r requirements.txt
```

4. Запустите программу:

```
python main.py
```

## Структура проекта

```
packer/
│
├── cleanup.py         - Управление очисткой временных файлов
├── config.py          - Настройки логирования и конфигурация
├── constants.py       - Константы и стандартные значения
├── dxf_generator.py   - Генерация DXF-файлов
├── gui.py             - Графический интерфейс пользователя
├── packing.py         - Алгоритмы упаковки деталей
├── patterns.py        - Работа с шаблонами узоров (заглушка)
├── remnants.py        - Управление остатками материала
└── utils.py           - Вспомогательные функции

main.py                - Точка входа в приложение
requirements.txt       - Список зависимостей
```

## Подготовка данных

Программа работает с двумя основными CSV-файлами:

### 1. Файл деталей (processed_data.csv)

Содержит информацию о деталях, которые нужно разместить на листах материала. Обязательные колонки:

- `part_id` - идентификатор детали
- `order_id` - идентификатор заказа
- `length_mm` - длина детали в мм (всегда большая сторона)
- `width_mm` - ширина детали в мм (всегда меньшая сторона)
- `quantity` - количество деталей
- `thickness_mm` - толщина материала
- `material` - тип материала (по умолчанию "S")
- `milling_type` - тип фрезеровки
- `bevel_type` - тип фаски
- `bevel_offset_mm` - смещение фаски в мм
- `f_long` - фаски по длине (0 - нет, 1 - с одной стороны, 2 - с обеих)
- `f_short` - фаски по ширине (0 - нет, 1 - с одной стороны, 2 - с обеих)

### 2. Файл материалов (materials.csv)

Содержит информацию о доступных материалах. Обязательные колонки:

- `thickness_mm` - толщина материала
- `material` - тип материала (по умолчанию "S")
- `sheet_length_mm` - длина листа в мм
- `sheet_width_mm` - ширина листа в мм
- `total_quantity` - доступное количество листов
- `is_remnant` - флаг остатка (true/false)
- `remnant_id` - идентификатор остатка (для остатков)

## Использование программы

### Запуск и настройка

1. Запустите программу двойным кликом по main.exe или командой `python main.py`
2. В открывшемся окне укажите:
   - Путь к файлу деталей (processed_data.csv)
   - Путь к файлу материалов (materials.csv)
   - Папку с узорами (опционально)
   - Папку для выходных файлов

### Настройка параметров

- **Отступ (мм)** - минимальный отступ от края листа и между деталями
- **Рез (мм)** - ширина реза фрезы
- **Сохранять временные файлы** - флаг для сохранения промежуточных файлов

### Управление процессом

- **Запустить раскрой** - начать процесс раскроя деталей
- **Очистить** - удалить все временные файлы и результаты
- **Очистить логи** - очистить только логи
- **Уровень логирования** - выбор детализации логов (INFO, DEBUG, WARNING, ERROR)

## Алгоритм работы программы

1. Программа считывает CSV-файлы с деталями и материалами
2. Данные проходят предварительную обработку и валидацию
3. Все детали группируются по комбинациям материал/толщина
4. Для каждой комбинации:
   - Сначала детали упаковываются в остатки (от больших к меньшим)
   - Затем оставшиеся детали упаковываются в целые листы
5. Создаются DXF-файлы с размещением деталей:
   - Для остатков: `[ID остатка]_[длина]x[ширина]_[толщина]mm_[материал].dxf`
   - Для целых листов: `sheet_[толщина]mm_[материал]_[индекс].dxf`
6. Обновляется таблица материалов с учетом использованных листов и новых остатков
7. Результаты сохраняются в указанную директорию

## Особенности работы с остатками

1. Программа приоритетно использует остатки перед целыми листами
2. Остатки от раскроя автоматически добавляются в обновленную таблицу материалов
3. Новые остатки имеют пустое значение в поле `remnant_id`, которое должно быть заполнено пользователем
4. Минимальный размер остатка для сохранения: 60x1000 мм

## Формат выходных DXF-файлов

Каждый DXF-файл содержит:

- Контур листа материала
- Контуры деталей с их размерами
- Линии реза для фрезерного станка
- Линии фасок (если указаны)
- Метки с информацией о деталях (ID детали, ID заказа, размеры)
- Список всех деталей, размещенных на листе

## Слои в DXF-файлах

- `0` - основной слой
- `dimensions` - размеры
- `TEXT` - текстовые метки
- `details` - контуры деталей
- `work_area` - рабочая область с отступом от края
- `cut` - линии реза
- `TITLE` - заголовок с именем файла
- `PARTSLIST` - список деталей
- Слои фасок - формируются по типу фаски

## Поддерживаемые форматы данных

- Кодировки файлов: UTF-8, UTF-8-SIG, WINDOWS-1251
- Разделитель в CSV: точка с запятой (`;`)
- DXF формат: совместимый с AutoCAD и другими CAD-системами

## Советы по использованию

- Для эффективного раскроя рекомендуется сначала добавить в таблицу материалов все имеющиеся остатки
- Каждый остаток должен иметь уникальный `remnant_id`
- Проверяйте обновленный файл материалов (`updated_materials.csv`) после каждого раскроя
- Для больших проектов рекомендуется устанавливать уровень логирования "INFO" или "WARNING"
- Программа сортирует детали для оптимального размещения, сначала располагая крупные, затем средние и мелкие детали

## Особенности и ограничения

- Минимальный размер остатка для сохранения: 60x1000 мм
- Максимальное количество остатков и деталей ограничено только оперативной памятью компьютера
- Поддерживается работа с фасками с любой стороны детали
- Программа оптимизирована для работы с МДФ, но подходит для любых листовых материалов

## Устранение неполадок

### Ошибка чтения CSV-файлов

- Проверьте кодировку файлов (UTF-8, WINDOWS-1251)
- Убедитесь, что используется разделитель ";" (точка с запятой)
- Проверьте наличие всех обязательных колонок

### Пустые DXF-файлы

- Проверьте, что размеры деталей корректны и больше нуля
- Убедитесь, что есть хотя бы один лист материала подходящего размера

### Проблемы с фасками

- Проверьте значения колонок `f_long` и `f_short` (должны быть 0, 1 или 2)
- Проверьте значение `bevel_offset_mm` (должно быть числом)

## Лицензия

[Укажите применимую лицензию проекта]

## Контакты

[Контактная информация для связи]
